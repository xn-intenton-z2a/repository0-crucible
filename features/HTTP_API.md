# HTTP API Feature

## Overview

Implement a full RESTful HTTP API exposing all core π operations, visualizations, benchmarks, searches, extractions, and streaming endpoints. Ensure robust input validation, proper error handling, and response formats matching content type conventions. This enhancement completes the partial /pi endpoint to cover the entire API surface defined in documentation.

## Endpoints

### GET /pi
- Query parameters:
  - digits (integer ≥1 and ≤1e6, required)
  - algorithm (machin | gauss-legendre | chudnovsky, default machin)
- Response: JSON `{ "pi": "<string>" }` with exactly `digits` characters (including integer part)

### GET /benchmark
- Query parameters:
  - minDigits (integer ≥1, default 100)
  - maxDigits (integer ≥minDigits, required)
  - step (integer ≥1, default = minDigits)
  - algorithm (machin | gauss-legendre, default machin)
  - outputCsv (boolean, default false)
- Behavior: invoke `benchmarkPi`, then:
  - If outputCsv=true, respond with `text/csv` lines `digits,timeMs`
  - Else respond with JSON array of `{ digits, timeMs }`

### GET /convergence
- Query parameters:
  - digits (integer ≥10, default 1000)
  - algorithm (supported values, default machin)
  - iterations (integer ≥2, default 10)
- Response: `image/png` binary of convergence chart generated by `visualizePiConvergence`

### GET /distribution
- Query parameters:
  - digits (integer ≥1, default 1000)
  - algorithm (supported values, default machin)
- Response: `image/png` binary of frequency bar chart generated by `visualizePiDigits`

### GET /distribution-json
- Query parameters:
  - digits, algorithm
- Response: JSON object mapping "0"–"9" to counts from `countPiDigitsJson`

### GET /search
- Query parameters:
  - pattern (digit string, required)
  - digits (integer ≥1, default 1000)
  - algorithm (default machin)
  - all (boolean, default false)
- Response: JSON `{ "position": <number|null> }` or `{ "positions": [<numbers>] }` from `searchPi`

### GET /hex
- Query parameters:
  - position (integer ≥0, required)
  - count (integer ≥1, default 1)
- Response: `text/plain` hex string from `extractPiHex`

### GET /decimal
- Query parameters:
  - position (integer ≥0, required)
  - count (integer ≥1, required)
  - algorithm (default machin)
- Response: `text/plain` decimal substring from `extractPiDecimal`

### GET /export
- Query parameters:
  - digits, algorithm
  - format (txt | json, default txt)
- Response:
  - text/plain when format=txt
  - application/json `{ "pi": "…" }` when format=json

### GET /pi/stream
- Query parameters:
  - digits, algorithm
- Response: `text/event-stream` SSE messages streaming blocks of π digits; send `event: end` on completion and `event: error` on failure

## CLI Interface

- Support `--serve` and `--port <n>` in `src/lib/main.js`.
- When `--serve` is provided, ignore other modes and start the HTTP API server implementing all above endpoints.
- Update CLI help output to document available HTTP routes and parameters.

## Dependencies

- Ensure existing dependencies support the full API:
  - express for routing and middleware
  - quickchart-js for chart rendering
  - js-yaml for script parsing in related features
  - No additional dependencies required

## Testing

- **Unit Tests** in `tests/unit/main.test.js` or new `tests/unit/http.test.js`:
  - Mock Express `req`/`res` to test each route handler with valid and invalid inputs
  - Verify correct status codes, headers, and response bodies (JSON, CSV, PNG, plain text, SSE)
  - Stub underlying library functions (`calculatePi`, `benchmarkPi`, etc.) to isolate routing logic

- **Integration Tests** in `tests/e2e/http.test.js`:
  - Start server on ephemeral port
  - Issue HTTP requests to each endpoint and assert:
    - Status codes (200, 400, etc.)
    - Content-Type and body formats
    - SSE endpoint behavior: accumulate `data:` events until `event: end`
